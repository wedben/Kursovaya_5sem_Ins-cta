# Определитель насекомых

Веб-приложение для поиска и определения насекомых (стрекоз, жуков и бабочек) по их характеристикам.

## Описание

Приложение позволяет пользователю:
1. Выбрать тип насекомого (стрекоза, жук или бабочка)
2. Указать параметры наблюдения (размер, цвет, место обитания, время года)
3. Получить список возможных видов из базы данных, соответствующих указанным параметрам

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Настройте подключение к PostgreSQL:
   - Скопируйте `.env.example` в `.env`
   - Заполните параметры подключения к вашей базе данных PostgreSQL:
   ```
   DB_HOST=localhost
   DB_PORT=5432
   DB_NAME=insects_db
   DB_USER=postgres
   DB_PASSWORD=your_password
   ```

3. Создайте таблицы в базе данных:
   ```bash
   # Вариант 1: Полная автоматическая настройка (рекомендуется)
   python scripts/setup_db.py
   
   # Вариант 2: Используя скрипт
   python scripts/run_sql.py sql/create_tables.sql
   
   # Вариант 3: Напрямую через psql
   psql -U postgres -d insects_db -f sql/create_tables.sql
   ```

4. Импортируйте данные из Excel файлов:
```bash
python scripts/import_excel_data.py
```

5. (Опционально) Добавьте примеры данных:
```bash
# Примеры насекомых (для старых таблиц dragonflies/beetles/butterflies)
python scripts/init_db.py

# Базовые данные для новых таблиц (СтатусТочности, Биотоп)
python scripts/init_additional_tables.py
```

## Запуск

Запустите приложение:
```bash
python app.py
```

Приложение будет доступно по адресу: http://localhost:5001

## Структура базы данных

База данных содержит следующие таблицы:

### Основные таблицы видов насекомых:
- `dragonflies` - Стрекозы
- `beetles` - Жуки
- `butterflies` - Бабочки

### Таблицы для системы наблюдений:
- `Пользователь` - Пользователи системы
- `МестоНаблюдения` - Места, где проводились наблюдения
- `ВидНасекомого` - Объединенная таблица всех видов насекомых
- `Биотоп` - Типы биотопов (лес, луг, водоем и т.д.)
- `СтатусТочности` - Статусы точности идентификации
- `Наблюдение` - Записи о наблюдениях насекомых
- `Идентификация` - Связь наблюдений с видами насекомых
- `ВидНасекомого_Биотоп` - Связь видов с биотопами (многие-ко-многим)

## Структура проекта

```
kursach/
├── app.py                    # Flask приложение с API endpoints
├── config.py                 # Конфигурация подключения к БД
├── database.py               # Модуль для работы с базой данных
├── requirements.txt          # Зависимости Python
├── README.md                 # Документация
├── PROJECT_STRUCTURE.md      # Подробная структура проекта
│
├── sql/                      # SQL скрипты
│   ├── create_tables.sql     # Создание таблиц
│   ├── Процедуры.sql         # Хранимые процедуры
│   ├── представления.sql     # Представления (views)
│   ├── триггеры-2.sql        # Триггеры
│   └── СБ.sql                # Права доступа
│
├── scripts/                  # Скрипты для настройки
│   ├── setup_db.py           # Полная настройка БД
│   ├── import_excel_data.py  # Импорт данных из Excel
│   └── ...
│
├── data/                     # Исходные данные
│   ├── стрекозы.xlsx
│   ├── жужжелицы.xlsx
│   └── Бабочки.xlsx
│
├── docs/                     # Документация
│   ├── INSTALL.md
│   ├── QUICK_SETUP.md
│   └── SETUP_DB.md
│
├── static/                   # Статические файлы
│   ├── css/style.css
│   ├── js/app.js
│   └── images/
│
└── templates/                # HTML шаблоны
    └── index.html
```

Подробнее см. [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md)

## Добавление данных

Для добавления новых насекомых в базу данных можно использовать метод `add_insect` класса `Database` или напрямую через SQL.

Пример:
```python
from database import Database

db = Database()
db.add_insect('dragonfly', {
    'name_ru': 'Название на русском',
    'name_lat': 'Название на латыни',
    'size_min': 20.0,
    'size_max': 30.0,
    'color': 'синий',
    'habitat': 'водоемы',
    'season': 'лето',
    'description': 'Подробное описание'
})
```

## API Endpoints

- `POST /api/search` - Поиск насекомых по параметрам
  - Body: `{"type": "dragonfly|beetle|butterfly", "params": {...}}`
  
- `GET /api/all/<insect_type>` - Получить все насекомые определенного типа

