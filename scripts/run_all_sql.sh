#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö SQL —Ñ–∞–π–ª–æ–≤ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

export PATH="/usr/local/opt/postgresql@14/bin:$PATH"

# –ü–æ–ª—É—á–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"
SQL_DIR="$PROJECT_ROOT/sql"

DB_NAME="insects_db"
DB_USER="wedben"

echo "üöÄ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö $DB_NAME"
echo ""

# 1. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (views)
if [ -f "$SQL_DIR/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.sql" ]; then
    echo "üìä –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π..."
    psql -U $DB_USER -d $DB_NAME -f "$SQL_DIR/–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.sql"
    echo "‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã"
    echo ""
fi

# 2. –ü—Ä–æ—Ü–µ–¥—É—Ä—ã
if [ -f "$SQL_DIR/–ü—Ä–æ—Ü–µ–¥—É—Ä—ã.sql" ]; then
    echo "‚öôÔ∏è  –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä..."
    psql -U $DB_USER -d $DB_NAME -f "$SQL_DIR/–ü—Ä–æ—Ü–µ–¥—É—Ä—ã.sql"
    echo "‚úÖ –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Å–æ–∑–¥–∞–Ω—ã"
    echo ""
fi

# 3. –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏
if [ -f "$SQL_DIR/–ø—Ä–æ—Ü–µ–¥—É—Ä—ã_—Å_–æ–ø–µ—Ä–∞—Ü–∏—è–º–∏_–Ω–∞–¥_–¥–∞–Ω–Ω—ã–º–∏.sql" ]; then
    echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ–¥—É—Ä —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏..."
    psql -U $DB_USER -d $DB_NAME -f "$SQL_DIR/–ø—Ä–æ—Ü–µ–¥—É—Ä—ã_—Å_–æ–ø–µ—Ä–∞—Ü–∏—è–º–∏_–Ω–∞–¥_–¥–∞–Ω–Ω—ã–º–∏.sql"
    echo "‚úÖ –ü—Ä–æ—Ü–µ–¥—É—Ä—ã —Å –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —Å–æ–∑–¥–∞–Ω—ã"
    echo ""
fi

# 4. –¢—Ä–∏–≥–≥–µ—Ä—ã
if [ -f "$SQL_DIR/—Ç—Ä–∏–≥–≥–µ—Ä—ã-2.sql" ]; then
    echo "üîî –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤..."
    psql -U $DB_USER -d $DB_NAME -f "$SQL_DIR/—Ç—Ä–∏–≥–≥–µ—Ä—ã-2.sql"
    echo "‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã"
    echo ""
fi

# 5. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (–°–ë.sql)
if [ -f "$SQL_DIR/–°–ë.sql" ]; then
    echo "üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
    psql -U $DB_USER -d $DB_NAME -f "$SQL_DIR/–°–ë.sql"
    echo "‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã"
    echo ""
fi

echo "‚úÖ –í—Å–µ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã!"

