<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å –Ω–∞—Å–µ–∫–æ–º—ã—Ö</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    {% if user %}
    <script id="user-data" type="application/json">{{ user | tojson }}</script>
    {% endif %}
</head>
<body>
    {% raw %}
    <div id="app">
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                <div>
                    <h1>ü¶ã –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ–ª—å –Ω–∞—Å–µ–∫–æ–º—ã—Ö ü¶ã</h1>
                    <p class="subtitle">–ù–∞–π–¥–∏—Ç–µ –Ω–∞—Å–µ–∫–æ–º–æ–µ –ø–æ –µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º</p>
                </div>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span v-if="currentUser" style="color: white; margin-right: 10px;">
                        üë§ {{ currentUser.name }} 
                        <span v-if="currentUser.role === '–∞–¥–º–∏–Ω'" style="background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">–ê–¥–º–∏–Ω</span>
                    </span>
                    <a v-if="!currentUser" href="/login" style="color: white; text-decoration: none; padding: 8px 15px; background: rgba(255,255,255,0.2); border-radius: 8px;">–í–æ–π—Ç–∏</a>
                    <a v-if="!currentUser" href="/register" style="color: white; text-decoration: none; padding: 8px 15px; background: rgba(255,255,255,0.2); border-radius: 8px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    <a v-if="currentUser" href="/my-requests" style="color: white; text-decoration: none; padding: 8px 15px; background: rgba(255,255,255,0.2); border-radius: 8px;">–ú–æ–∏ –∑–∞–ø—Ä–æ—Å—ã</a>
                    <a v-if="currentUser && currentUser.role === '–∞–¥–º–∏–Ω'" href="/admin" style="color: white; text-decoration: none; padding: 8px 15px; background: rgba(255,255,255,0.2); border-radius: 8px;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
                    <button v-if="currentUser" @click="logout" style="color: white; padding: 8px 15px; background: rgba(255,255,255,0.2); border: none; border-radius: 8px; cursor: pointer;">–í—ã—Ö–æ–¥</button>
                </div>
            </div>
        </header>

        <main>
                <div class="main-actions">
                    <button @click="showAllInsects" class="view-all-btn">
                        üìö –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –Ω–∞—Å–µ–∫–æ–º—ã–µ
                    </button>
                    <button v-if="currentUser" @click="showExpertRequestForm = !showExpertRequestForm" class="view-all-btn" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        üí¨ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å —ç–∫—Å–ø–µ—Ä—Ç—É
                    </button>
                </div>

                <!-- –§–æ—Ä–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ —ç–∫—Å–ø–µ—Ä—Ç—É -->
                <div v-if="showExpertRequestForm && currentUser" class="expert-request-form" style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 15px;">
                    <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–∞</h3>
                    <p style="color: #666; margin-bottom: 15px;">–û–ø–∏—à–∏—Ç–µ –Ω–∞—Å–µ–∫–æ–º–æ–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –≤–∏–¥–µ–ª–∏, –∏ —ç–∫—Å–ø–µ—Ä—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –µ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å</p>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ *</label>
                        <textarea v-model="expertRequest.description" 
                                  placeholder="–û–ø–∏—à–∏—Ç–µ –Ω–∞—Å–µ–∫–æ–º–æ–µ: —Ä–∞–∑–º–µ—Ä, —Ü–≤–µ—Ç, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏, –ø–æ–≤–µ–¥–µ–Ω–∏–µ..."
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; min-height: 120px; font-family: inherit;"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">–ú–µ—Å—Ç–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</label>
                            <input v-model="expertRequest.location" 
                                   placeholder="–ì–¥–µ –≤—ã –≤–∏–¥–µ–ª–∏ –Ω–∞—Å–µ–∫–æ–º–æ–µ?"
                                   style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">–î–∞—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è</label>
                            <input v-model="expertRequest.observation_date" 
                                   type="date"
                                   style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 600;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                        <textarea v-model="expertRequest.additional_data" 
                                  placeholder="–õ—é–±–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è..."
                                  style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; min-height: 80px; font-family: inherit;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button @click="submitExpertRequest" 
                                :disabled="!expertRequest.description || submittingRequest"
                                style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em;">
                            {{ submittingRequest ? '–û—Ç–ø—Ä–∞–≤–∫–∞...' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å —ç–∫—Å–ø–µ—Ä—Ç—É' }}
                        </button>
                        <button @click="showExpertRequestForm = false; resetExpertRequest()" 
                                style="padding: 12px 30px; background: #6c757d; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1em;">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                    
                    <div v-if="expertRequestError" style="color: red; margin-top: 10px;">{{ expertRequestError }}</div>
                    <div v-if="expertRequestSuccess" style="color: green; margin-top: 10px;">{{ expertRequestSuccess }}</div>
                </div>

                <div class="search-section">
                    <h2>–ö–æ–≥–æ –≤—ã –≤–∏–¥–µ–ª–∏?</h2>
                    
                    <div class="insect-type-selector">
                        <button 
                            v-for="type in insectTypes" 
                            :key="type.value"
                            class="insect-btn"
                            :class="{ active: selectedType === type.value }"
                            @click="selectType(type.value)"
                        >
                            <span v-if="type.image" class="icon icon-image">
                                <img :src="type.image" :alt="type.label" class="insect-icon-img">
                            </span>
                            <span v-else class="icon">{{ type.icon }}</span>
                            <span>{{ type.label }}</span>
                        </button>
                    </div>
                    
                    <div v-if="selectedType" class="params-form">
                        <h3>üîç –£–∫–∞–∂–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:</h3>
                        
                        <!-- –§–ò–õ–¨–¢–†–´ –î–õ–Ø –°–¢–†–ï–ö–û–ó -->
                        <div v-if="selectedType === 'dragonfly'" class="filters-grid">
                            <!-- –ü–æ–ª —Å—Ç—Ä–µ–∫–æ–∑—ã -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">‚ö•</span>
                                    <label>–ü–æ–ª</label>
                                </div>
                                <div class="gender-buttons">
                                    <button 
                                        class="gender-btn"
                                        :class="{ active: searchParams.gender === '—Å–∞–º–µ—Ü' }"
                                        @click="searchParams.gender = searchParams.gender === '—Å–∞–º–µ—Ü' ? '' : '—Å–∞–º–µ—Ü'"
                                    >
                                        ‚ôÇÔ∏è –°–∞–º–µ—Ü
                                    </button>
                                    <button 
                                        class="gender-btn"
                                        :class="{ active: searchParams.gender === '—Å–∞–º–∫–∞' }"
                                        @click="searchParams.gender = searchParams.gender === '—Å–∞–º–∫–∞' ? '' : '—Å–∞–º–∫–∞'"
                                    >
                                        ‚ôÄÔ∏è –°–∞–º–∫–∞
                                    </button>
                                </div>
                            </div>
                            
                            <!-- –î–ª–∏–Ω–∞ —Ç–µ–ª–∞ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìè</span>
                                    <label>–î–ª–∏–Ω–∞ —Ç–µ–ª–∞ (–º–º)</label>
                                </div>
                                <div class="size-inputs">
                                    <input type="number" v-model.number="searchParams.bodyLengthMin" step="0.1" min="0" placeholder="–æ—Ç" class="size-input">
                                    <span class="size-separator">‚Äî</span>
                                    <input type="number" v-model.number="searchParams.bodyLengthMax" step="0.1" min="0" placeholder="–¥–æ" class="size-input">
                                </div>
                            </div>
                            
                            <!-- –†–∞–∑–º–∞—Ö –∫—Ä—ã–ª—å–µ–≤ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">ü¶ã</span>
                                    <label>–†–∞–∑–º–∞—Ö –∫—Ä—ã–ª—å–µ–≤ (–º–º)</label>
                                </div>
                                <div class="size-inputs">
                                    <input type="number" v-model.number="searchParams.wingspanMin" step="0.1" min="0" placeholder="–æ—Ç" class="size-input">
                                    <span class="size-separator">‚Äî</span>
                                    <input type="number" v-model.number="searchParams.wingspanMax" step="0.1" min="0" placeholder="–¥–æ" class="size-input">
                                </div>
                            </div>
                            
                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üé®</span>
                                    <label>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</label>
                                </div>
                                <div class="color-quick-select">
                                    <div class="quick-colors-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</div>
                                    <div class="quick-color-tags">
                                        <span 
                                            v-for="color in filterOptions.basicColors" 
                                            :key="color"
                                            class="quick-color-tag"
                                            :class="{ active: searchParams.color.toLowerCase().includes(color.toLowerCase()) }"
                                            @click="selectQuickColor(color)"
                                        >
                                            {{ color }}
                                        </span>
                                    </div>
                                </div>
                                <select v-model="searchParams.color" class="select-input">
                                    <option value="">–í—Å–µ —Ü–≤–µ—Ç–∞ (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫)...</option>
                                    <option v-for="color in filterOptions.colors" :key="color" :value="color">
                                        {{ color }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –¶–≤–µ—Ç –≥–ª–∞–∑ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üëÅÔ∏è</span>
                                    <label>–¶–≤–µ—Ç –≥–ª–∞–∑</label>
                                </div>
                                <div class="color-quick-select">
                                    <div class="quick-colors-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</div>
                                    <div class="quick-color-tags">
                                        <span 
                                            v-for="color in filterOptions.basicEyeColors" 
                                            :key="color"
                                            class="quick-color-tag"
                                            :class="{ active: searchParams.eyeColor.toLowerCase().includes(color.toLowerCase()) }"
                                            @click="selectQuickEyeColor(color)"
                                        >
                                            {{ color }}
                                        </span>
                                    </div>
                                </div>
                                <select v-model="searchParams.eyeColor" class="select-input">
                                    <option value="">–í—Å–µ —Ü–≤–µ—Ç–∞ –≥–ª–∞–∑ (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫)...</option>
                                    <option v-for="color in filterOptions.eyeColors" :key="color" :value="color">
                                        {{ color }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìç</span>
                                    <label>–ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="habitat in filterOptions.basicHabitats" 
                                        :key="habitat"
                                        class="color-tag"
                                        :class="{ active: searchParams.habitat === habitat }"
                                        @click="toggleBasicHabitat(habitat)"
                                    >
                                        {{ habitat }}
                                    </span>
                                </div>
                                <select v-model="searchParams.habitat" class="select-input full-width-select">
                                    <option value="">–í—Å–µ –º–µ—Å—Ç–∞</option>
                                    <option v-for="habitat in filterOptions.allHabitats" :key="habitat" :value="habitat">
                                        {{ habitat }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –°—Ä–µ–¥–∞ (—Ç–∏–ø –≤–æ–¥–æ—ë–º–∞) -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üíß</span>
                                    <label>–°—Ä–µ–¥–∞ (—Ç–∏–ø –≤–æ–¥–æ—ë–º–∞)</label>
                                </div>
                                <select v-model="searchParams.environment" class="select-input">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ä–µ–¥—É –æ–±–∏—Ç–∞–Ω–∏—è...</option>
                                    <option v-for="env in filterOptions.environments" :key="env" :value="env">
                                        {{ env }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –ü–µ—Ä–∏–æ–¥ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìÖ</span>
                                    <label>–ü–µ—Ä–∏–æ–¥</label>
                                </div>
                                <select v-model="searchParams.season" class="select-input">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥...</option>
                                    <option v-for="season in filterOptions.seasons" :key="season" :value="season">
                                        {{ season }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- –§–ò–õ–¨–¢–†–´ –î–õ–Ø –ñ–£–ö–û–í -->
                        <div v-if="selectedType === 'beetle'" class="filters-grid">
                            <!-- –î–ª–∏–Ω–∞ —Ç–µ–ª–∞ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìè</span>
                                    <label>–î–ª–∏–Ω–∞ —Ç–µ–ª–∞ (–º–º)</label>
                                </div>
                                <div class="size-inputs">
                                    <input type="number" v-model.number="searchParams.sizeMin" step="0.1" min="0" placeholder="–æ—Ç" class="size-input">
                                    <span class="size-separator">‚Äî</span>
                                    <input type="number" v-model.number="searchParams.sizeMax" step="0.1" min="0" placeholder="–¥–æ" class="size-input">
                                </div>
                            </div>
                            
                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üé®</span>
                                    <label>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç</label>
                                </div>
                                <div class="color-quick-select">
                                    <div class="quick-colors-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</div>
                                    <div class="quick-color-tags">
                                        <span 
                                            v-for="color in filterOptions.basicColors" 
                                            :key="color"
                                            class="quick-color-tag"
                                            :class="{ active: searchParams.color.toLowerCase().includes(color.toLowerCase()) }"
                                            @click="selectQuickColor(color)"
                                        >
                                            {{ color }}
                                        </span>
                                    </div>
                                </div>
                                <select v-model="searchParams.color" class="select-input">
                                    <option value="">–í—Å–µ —Ü–≤–µ—Ç–∞ (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫)...</option>
                                    <option v-for="color in filterOptions.colors" :key="color" :value="color">
                                        {{ color }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –¢–∏–ø –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ / –ë–ª–µ—Å–∫ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">‚ú®</span>
                                    <label>–¢–∏–ø –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ / –ë–ª–µ—Å–∫</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="type in filterOptions.basicSurfaceTypes" 
                                        :key="type"
                                        class="color-tag"
                                        :class="{ active: searchParams.surfaceType === type }"
                                        @click="toggleBasicSurfaceType(type)"
                                    >
                                        {{ type }}
                                    </span>
                                </div>
                                <select v-model="searchParams.surfaceType" class="select-input full-width-select">
                                    <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                    <option v-for="type in filterOptions.allSurfaceTypes" :key="type" :value="type">
                                        {{ type }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –ù–∞–¥–∫—Ä—ã–ª—å—è -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üõ°Ô∏è</span>
                                    <label>–ù–∞–¥–∫—Ä—ã–ª—å—è</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="elytra in filterOptions.basicElytra" 
                                        :key="elytra"
                                        class="color-tag"
                                        :class="{ active: searchParams.elytra === elytra }"
                                        @click="toggleBasicElytra(elytra)"
                                    >
                                        {{ elytra }}
                                    </span>
                                </div>
                                <select v-model="searchParams.elytra" class="select-input full-width-select">
                                    <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                    <option v-for="elytra in filterOptions.allElytra" :key="elytra" :value="elytra">
                                        {{ elytra }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìç</span>
                                    <label>–ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="habitat in filterOptions.basicHabitats" 
                                        :key="habitat"
                                        class="color-tag"
                                        :class="{ active: searchParams.habitat === habitat }"
                                        @click="toggleBasicHabitat(habitat)"
                                    >
                                        {{ habitat }}
                                    </span>
                                </div>
                                <select v-model="searchParams.habitat" class="select-input full-width-select">
                                    <option value="">–í—Å–µ –º–µ—Å—Ç–∞</option>
                                    <option v-for="habitat in filterOptions.allHabitats" :key="habitat" :value="habitat">
                                        {{ habitat }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –ü–µ—Ä–∏–æ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìÖ</span>
                                    <label>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å / –ü–µ—Ä–∏–æ–¥</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="season in filterOptions.basicSeasons" 
                                        :key="season"
                                        class="color-tag"
                                        :class="{ active: searchParams.season === season }"
                                        @click="toggleBasicSeason(season)"
                                    >
                                        {{ season }}
                                    </span>
                                </div>
                                <select v-model="searchParams.season" class="select-input full-width-select">
                                    <option value="">–í—Å–µ –ø–µ—Ä–∏–æ–¥—ã</option>
                                    <option v-for="season in filterOptions.allSeasons" :key="season" :value="season">
                                        {{ season }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- –§–ò–õ–¨–¢–†–´ –î–õ–Ø –ë–ê–ë–û–ß–ï–ö -->
                        <div v-if="selectedType === 'butterfly'" class="filters-grid">
                            <!-- –†–∞–∑–º–∞—Ö –∫—Ä—ã–ª—å–µ–≤ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">ü¶ã</span>
                                    <label>–†–∞–∑–º–∞—Ö –∫—Ä—ã–ª—å–µ–≤ (–º–º)</label>
                                </div>
                                <div class="size-inputs">
                                    <input type="number" v-model.number="searchParams.sizeMin" step="0.1" min="0" placeholder="–æ—Ç" class="size-input">
                                    <span class="size-separator">‚Äî</span>
                                    <input type="number" v-model.number="searchParams.sizeMax" step="0.1" min="0" placeholder="–¥–æ" class="size-input">
                                </div>
                            </div>
                            
                            <!-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∫—Ä—ã–ª—å–µ–≤ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üé®</span>
                                    <label>–û—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∫—Ä—ã–ª—å–µ–≤</label>
                                </div>
                                <div class="color-quick-select">
                                    <div class="quick-colors-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä:</div>
                                    <div class="quick-color-tags">
                                        <span 
                                            v-for="color in filterOptions.basicColors" 
                                            :key="color"
                                            class="quick-color-tag"
                                            :class="{ active: searchParams.color.toLowerCase().includes(color.toLowerCase()) }"
                                            @click="selectQuickColor(color)"
                                        >
                                            {{ color }}
                                        </span>
                                    </div>
                                </div>
                                <select v-model="searchParams.color" class="select-input">
                                    <option value="">–í—Å–µ —Ü–≤–µ—Ç–∞ (—Ç–æ—á–Ω—ã–π –ø–æ–∏—Å–∫)...</option>
                                    <option v-for="color in filterOptions.colors" :key="color" :value="color">
                                        {{ color }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∏—Å—É–Ω–∫–∞ –∫—Ä—ã–ª—å–µ–≤ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üé≠</span>
                                    <label>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∏—Å—É–Ω–∫–∞ –∫—Ä—ã–ª—å–µ–≤</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="pattern in filterOptions.basicWingPatterns" 
                                        :key="pattern"
                                        class="color-tag"
                                        :class="{ active: searchParams.wingPattern === pattern }"
                                        @click="toggleBasicWingPattern(pattern)"
                                    >
                                        {{ pattern }}
                                    </span>
                                </div>
                                <select v-model="searchParams.wingPattern" class="select-input full-width-select">
                                    <option value="">–í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã</option>
                                    <option v-for="pattern in filterOptions.allWingPatterns" :key="pattern" :value="pattern">
                                        {{ pattern }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –í—Ä–µ–º—è —Å—É—Ç–æ–∫ (–¥–µ–Ω—å/–Ω–æ—á—å) -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üåì</span>
                                    <label>–í—Ä–µ–º—è —Å—É—Ç–æ–∫</label>
                                </div>
                                <div class="time-buttons">
                                    <button 
                                        class="time-btn"
                                        :class="{ active: searchParams.timeOfDay === '–¥–µ–Ω—å' }"
                                        @click="searchParams.timeOfDay = searchParams.timeOfDay === '–¥–µ–Ω—å' ? '' : '–¥–µ–Ω—å'"
                                    >
                                        ‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è
                                    </button>
                                    <button 
                                        class="time-btn"
                                        :class="{ active: searchParams.timeOfDay === '–Ω–æ—á—å' }"
                                        @click="searchParams.timeOfDay = searchParams.timeOfDay === '–Ω–æ—á—å' ? '' : '–Ω–æ—á—å'"
                                    >
                                        üåô –ù–æ—á–Ω–∞—è
                                    </button>
                                </div>
                            </div>
                            
                            <!-- –ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìç</span>
                                    <label>–ú–µ—Å—Ç–æ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="habitat in filterOptions.basicHabitats" 
                                        :key="habitat"
                                        class="color-tag"
                                        :class="{ active: searchParams.habitat === habitat }"
                                        @click="toggleBasicHabitat(habitat)"
                                    >
                                        {{ habitat }}
                                    </span>
                                </div>
                                <select v-model="searchParams.habitat" class="select-input full-width-select">
                                    <option value="">–í—Å–µ –º–µ—Å—Ç–∞</option>
                                    <option v-for="habitat in filterOptions.allHabitats" :key="habitat" :value="habitat">
                                        {{ habitat }}
                                    </option>
                                </select>
                            </div>
                            
                            <!-- –ü–µ—Ä–∏–æ–¥ –ª—ë—Ç–∞ -->
                            <div class="filter-card">
                                <div class="filter-header">
                                    <span class="filter-icon">üìÖ</span>
                                    <label>–ü–µ—Ä–∏–æ–¥ –ª—ë—Ç–∞</label>
                                </div>
                                <div class="color-tags">
                                    <span 
                                        v-for="season in filterOptions.basicSeasons" 
                                        :key="season"
                                        class="color-tag"
                                        :class="{ active: searchParams.season === season }"
                                        @click="toggleBasicSeason(season)"
                                    >
                                        {{ season }}
                                    </span>
                                </div>
                                <select v-model="searchParams.season" class="select-input full-width-select">
                                    <option value="">–í—Å–µ –ø–µ—Ä–∏–æ–¥—ã</option>
                                    <option v-for="season in filterOptions.allSeasons" :key="season" :value="season">
                                        {{ season }}
                                    </option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button @click="searchInsects" class="search-btn" :disabled="loading">
                                <span v-if="!loading">üîç</span>
                                <span v-else class="spinner-small"></span>
                                {{ loading ? '–ü–æ–∏—Å–∫...' : '–ù–∞–π—Ç–∏ –Ω–∞—Å–µ–∫–æ–º—ã—Ö' }}
                            </button>
                            <button @click="clearForm" class="clear-btn">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                            </button>
                        </div>
                    </div>
                </div>

                <div v-if="loading" class="loading">
                    <div class="spinner"></div>
                    <p>–ü–æ–∏—Å–∫...</p>
                    </div>
                    
                <div v-if="results.length > 0 || (searchPerformed && results.length === 0) || viewingAll" class="results-section">
                    <div class="results-header">
                        <h2 v-if="viewingAll">–í—Å–µ –Ω–∞—Å–µ–∫–æ–º—ã–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</h2>
                        <h2 v-else>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                        <button v-if="viewingAll" @click="closeViewAll" class="close-view-btn">
                            ‚úï –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                    
                    <!-- –ü–æ–∏—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö -->
                    <div v-if="viewingAll" class="view-all-search">
                        <div class="search-box">
                            <span class="search-icon">üîç</span>
                            <input 
                                type="text" 
                                v-model="viewAllSearchQuery"
                                @input="filterViewAllResults"
                                placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, —Ü–≤–µ—Ç—É, –º–µ—Å—Ç—É –æ–±–∏—Ç–∞–Ω–∏—è..."
                                class="view-all-search-input"
                            >
                            <button v-if="viewAllSearchQuery" @click="clearViewAllSearch" class="clear-search-btn">
                                ‚úï
                            </button>
                        </div>
                        <div class="view-all-filters">
                            <select v-model="viewAllTypeFilter" @change="filterViewAllResults" class="type-filter-select">
                                <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                                <option value="dragonfly">–°—Ç—Ä–µ–∫–æ–∑—ã</option>
                                <option value="beetle">–ñ—É–∫–∏</option>
                                <option value="butterfly">–ë–∞–±–æ—á–∫–∏</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="results-count">
                        <span v-if="viewingAll">
                            <span v-if="viewAllSearchQuery || viewAllTypeFilter">
                                –ù–∞–π–¥–µ–Ω–æ {{ filteredViewAllResults.length }} –∏–∑ {{ allInsectsCount }} –Ω–∞—Å–µ–∫–æ–º—ã—Ö
                            </span>
                            <span v-else>
                                –í—Å–µ–≥–æ {{ results.length }} –Ω–∞—Å–µ–∫–æ–º—ã—Ö
                            </span>
                        </span>
                        <span v-else>
                            –ù–∞–π–¥–µ–Ω–æ {{ results.length }} {{ getTypeName(results.length) }}
                        </span>
                    </div>
                    <div v-if="results.length === 0" class="no-results">
                        –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ –≤–∞—à–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞.
                    </div>
                    <div v-else class="results-container">
                        <div v-for="insect in (viewingAll ? filteredViewAllResults : results)" :key="insect.id" class="insect-card">
                            <div class="card-header" :class="{ 'male-card': extractGender(insect.description) === '—Å–∞–º–µ—Ü', 'female-card': extractGender(insect.description) === '—Å–∞–º–∫–∞' }">
                                <div class="card-icon">
                                    <img v-if="isImageIcon(getTypeIcon(insect.insect_type || selectedType))" 
                                         :src="getTypeIcon(insect.insect_type || selectedType)" 
                                         :alt="getTypeLabel(insect.insect_type || selectedType)"
                                         class="card-icon-img">
                                    <span v-else>{{ getTypeIcon(insect.insect_type || selectedType) }}</span>
                                </div>
                                <div class="card-title">
                                    <div class="title-row">
                                        <h3>{{ insect.name_ru || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</h3>
                                        <div v-if="extractGender(insect.description)" class="gender-badge" :class="extractGender(insect.description)">
                                            <span class="gender-icon">{{ getGenderIcon(extractGender(insect.description)) }}</span>
                                            <span class="gender-text">{{ extractGender(insect.description) }}</span>
                                        </div>
                                    </div>
                                    <div v-if="insect.name_lat" class="name-lat">{{ insect.name_lat }}</div>
                                    <div v-if="insect.insect_type && viewingAll" class="insect-type-badge">
                                        {{ getTypeLabel(insect.insect_type) }}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card-body">
                                <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ (—Å–∫—Ä—ã—Ç–æ) -->
                                <!-- <div v-if="insect.image_url" class="insect-image-container">
                                    <img :src="insect.image_url" 
                                         :alt="insect.name_ru || '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞—Å–µ–∫–æ–º–æ–≥–æ'"
                                         class="insect-image"
                                         @error="handleImageError"
                                         loading="lazy">
                                </div> -->
                                
                                <div v-if="insect.size_min || insect.size_max" class="detail-item">
                                    <span class="detail-icon">üìè</span>
                                    <div class="detail-content">
                                        <strong>–†–∞–∑–º–µ—Ä:</strong> 
                                        <span class="detail-value">{{ formatSize(insect.size_min, insect.size_max) }}</span>
                                    </div>
                                </div>
                                
                                <div v-if="insect.color" class="detail-item">
                                    <span class="detail-icon">üé®</span>
                                    <div class="detail-content">
                                        <strong>–¶–≤–µ—Ç:</strong> 
                                        <span class="detail-value color-badge">{{ insect.color }}</span>
                                    </div>
                    </div>
                    
                                <div v-if="insect.habitat" class="detail-item">
                                    <span class="detail-icon">üå≥</span>
                                    <div class="detail-content">
                                        <strong>–ú–µ—Å—Ç–æ –æ–±–∏—Ç–∞–Ω–∏—è:</strong> 
                                        <span class="detail-value">{{ insect.habitat }}</span>
                </div>
            </div>

                                <div v-if="insect.season" class="detail-item">
                                    <span class="detail-icon">üìÖ</span>
                                    <div class="detail-content">
                                        <strong>–ü–µ—Ä–∏–æ–¥:</strong> 
                                        <span class="detail-value">{{ insect.season }}</span>
                                    </div>
            </div>

                                <div v-if="cleanDescription(insect.description)" class="description">
                                    <div class="description-header">‚ÑπÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</div>
                                    <div class="description-text">{{ cleanDescription(insect.description) }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
        </main>
        </div>
    </div>
    {% endraw %}

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

